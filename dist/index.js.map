{"version":3,"sources":["../src/index.ts"],"names":["fs","DevtoolsPlugin","HttpPlugin","https","App","ConsoleLogger","path","listOrders","renameCustomer","updateOrder","seedIfEmpty"],"mappings":"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","file":"index.js","sourcesContent":["import fs from \"fs\";\nimport https from \"https\";\nimport path from \"path\";\n\nimport { App, HttpPlugin, IPlugin } from \"@microsoft/teams.apps\";\nimport { ConsoleLogger } from \"@microsoft/teams.common/logging\";\nimport { DevtoolsPlugin } from \"@microsoft/teams.dev\";\n\nimport { listOrders, renameCustomer, seedIfEmpty, updateOrder, type OrderStatus } from \"./ordersService.js\";\n\nconst STORAGE_CONNECTION =\n  process.env.AZURE_STORAGE_CONNECTION_STRING ?? \"UseDevelopmentStorage=true\";\n\nconst sslOptions = {\n  key: process.env.SSL_KEY_FILE ? fs.readFileSync(process.env.SSL_KEY_FILE) : undefined,\n  cert: process.env.SSL_CRT_FILE ? fs.readFileSync(process.env.SSL_CRT_FILE) : undefined,\n};\nconst plugins: IPlugin[] = [new DevtoolsPlugin()];\nif (sslOptions.cert && sslOptions.key) {\n  plugins.push(new HttpPlugin(https.createServer(sslOptions)));\n}\nconst app = new App({\n  logger: new ConsoleLogger(\"tab\", { level: \"debug\" }),\n  plugins: plugins,\n});\n\napp.tab(\"home\", path.join(__dirname, \"./Home\"));\napp.tab(\"customers\", path.join(__dirname, \"./Customers\"));\n\n// REST API â€“ orders\napp.http.use(require(\"express\").json());\n\napp.http.get(\"/api/orders\", async (_req, res) => {\n  try {\n    const orders = await listOrders(STORAGE_CONNECTION);\n    res.json(orders);\n  } catch (err) {\n    res.status(500).json({ error: String(err) });\n  }\n});\n\napp.http.get(\"/api/customers/:name/orders\", async (req, res) => {\n  try {\n    const { name } = req.params as { name: string };\n    const orders = await listOrders(STORAGE_CONNECTION);\n    res.json(orders.filter((o) => o.customer === decodeURIComponent(name)));\n  } catch (err) {\n    res.status(500).json({ error: String(err) });\n  }\n});\n\napp.http.put(\"/api/customers/:name\", async (req, res) => {\n  try {\n    const { name } = req.params as { name: string };\n    const { newName } = req.body as { newName: string };\n    const updated = await renameCustomer(STORAGE_CONNECTION, decodeURIComponent(name), newName);\n    res.json({ updated });\n  } catch (err) {\n    res.status(500).json({ error: String(err) });\n  }\n});\n\napp.http.put(\"/api/orders/:id\", async (req, res) => {\n  try {\n    const { id } = req.params as { id: string };\n    const patch = req.body as { customer?: string; amount?: number; status?: OrderStatus; date?: string };\n    const updated = await updateOrder(STORAGE_CONNECTION, id, patch);\n    res.json(updated);\n  } catch (err) {\n    res.status(500).json({ error: String(err) });\n  }\n});\n\n(async () => {\n  await seedIfEmpty(STORAGE_CONNECTION);\n  await app.start(+(process.env.PORT || 3978));\n})();\n"]}