{"version":3,"sources":["../src/ordersService.ts"],"names":["TableServiceClient","TableClient","TableTransaction"],"mappings":"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","file":"ordersService.js","sourcesContent":["import { TableClient, TableServiceClient, TableTransaction } from \"@azure/data-tables\";\r\n\r\nexport type OrderStatus = \"Pending\" | \"Processing\" | \"Shipped\" | \"Delivered\" | \"Cancelled\";\r\n\r\nexport interface Order {\r\n  id: string;\r\n  customer: string;\r\n  amount: number;\r\n  status: OrderStatus;\r\n  date: string;\r\n}\r\n\r\nconst TABLE_NAME = \"Orders\";\r\nconst PARTITION_KEY = \"Orders\";\r\n\r\nconst CUSTOMERS = [\r\n  \"Contoso Ltd.\",       \"Fabrikam Inc.\",        \"Northwind Traders\",\r\n  \"Adventure Works\",    \"Tailspin Toys\",         \"Woodgrove Bank\",\r\n  \"Proseware Inc.\",     \"Lucerne Publishing\",    \"Humongous Insurance\",\r\n  \"Wide World Importers\", \"Fourth Coffee\",       \"Alpine Ski House\",\r\n  \"Coho Winery\",        \"Relecloud\",             \"Trey Research\",\r\n];\r\n\r\nconst STATUSES: OrderStatus[] = [\"Pending\", \"Processing\", \"Shipped\", \"Delivered\", \"Cancelled\"];\r\n\r\nfunction randomDate(daysBack = 365): string {\r\n  const now = new Date(\"2026-02-24\");\r\n  const offset = Math.floor(Math.random() * daysBack * 24 * 60 * 60 * 1000);\r\n  return new Date(now.getTime() - offset).toISOString().slice(0, 10);\r\n}\r\n\r\nfunction generateOrders(count: number): Array<{\r\n  partitionKey: string; rowKey: string;\r\n  id: string; customer: string; amount: number; status: string; date: string;\r\n}> {\r\n  const orders = [];\r\n  for (let i = 1; i <= count; i++) {\r\n    const id = `ORD-${String(i).padStart(3, \"0\")}`;\r\n    orders.push({\r\n      partitionKey: PARTITION_KEY,\r\n      rowKey: id,\r\n      id,\r\n      customer: CUSTOMERS[Math.floor(Math.random() * CUSTOMERS.length)],\r\n      amount: Math.round((Math.random() * 9900 + 100) * 100) / 100,\r\n      status: STATUSES[Math.floor(Math.random() * STATUSES.length)],\r\n      date: randomDate(),\r\n    });\r\n  }\r\n  return orders;\r\n}\r\n\r\nfunction getClients(connectionString: string) {\r\n  return {\r\n    service: TableServiceClient.fromConnectionString(connectionString),\r\n    table: TableClient.fromConnectionString(connectionString, TABLE_NAME),\r\n  };\r\n}\r\n\r\n/** Creates the Orders table and seeds 100 rows if it is empty. */\r\nexport async function seedIfEmpty(connectionString: string): Promise<void> {\r\n  const { service, table } = getClients(connectionString);\r\n\r\n  await service.createTable(TABLE_NAME).catch(() => { /* already exists */ });\r\n\r\n  const iter = table.listEntities({ queryOptions: { select: [\"rowKey\"] } });\r\n  const first = await iter.next();\r\n  if (!first.done) {\r\n    return; // already has data\r\n  }\r\n\r\n  const transaction = new TableTransaction();\r\n  for (const order of generateOrders(100)) {\r\n    transaction.createEntity(order);\r\n  }\r\n  await table.submitTransaction(transaction.actions);\r\n}\r\n\r\n/** Returns all orders sorted by ID. */\r\nexport async function listOrders(connectionString: string): Promise<Order[]> {\r\n  const { table } = getClients(connectionString);\r\n  const orders: Order[] = [];\r\n\r\n  for await (const entity of table.listEntities<{\r\n    id: string; customer: string; amount: number; status: string; date: string;\r\n  }>()) {\r\n    orders.push({\r\n      id: entity.rowKey!,\r\n      customer: entity.customer,\r\n      amount: entity.amount,\r\n      status: entity.status as OrderStatus,\r\n      date: entity.date,\r\n    });\r\n  }\r\n\r\n  return orders.sort((a, b) => a.id.localeCompare(b.id));\r\n}\r\n\r\n/** Renames a customer on all their orders. Returns the number of orders updated. */\r\nexport async function renameCustomer(\r\n  connectionString: string,\r\n  oldName: string,\r\n  newName: string,\r\n): Promise<number> {\r\n  const { table } = getClients(connectionString);\r\n  const toUpdate: Order[] = [];\r\n\r\n  for await (const entity of table.listEntities<{\r\n    id: string; customer: string; amount: number; status: string; date: string;\r\n  }>()) {\r\n    if (entity.customer === oldName) {\r\n      toUpdate.push({\r\n        id: entity.rowKey!,\r\n        customer: entity.customer,\r\n        amount: entity.amount,\r\n        status: entity.status as OrderStatus,\r\n        date: entity.date,\r\n      });\r\n    }\r\n  }\r\n\r\n  for (const order of toUpdate) {\r\n    await table.updateEntity({\r\n      partitionKey: PARTITION_KEY,\r\n      rowKey: order.id,\r\n      id: order.id,\r\n      customer: newName,\r\n      amount: order.amount,\r\n      status: order.status,\r\n      date: order.date,\r\n    }, \"Replace\");\r\n  }\r\n\r\n  return toUpdate.length;\r\n}\r\n\r\n/** Updates an existing order in Table Storage. */\r\nexport async function updateOrder(\r\n  connectionString: string,\r\n  id: string,\r\n  patch: Partial<Omit<Order, \"id\">>\r\n): Promise<Order> {\r\n  const { table } = getClients(connectionString);\r\n\r\n  const existing = await table.getEntity<{\r\n    id: string; customer: string; amount: number; status: string; date: string;\r\n  }>(PARTITION_KEY, id);\r\n\r\n  const updated = {\r\n    partitionKey: PARTITION_KEY,\r\n    rowKey: id,\r\n    id,\r\n    customer:  patch.customer  ?? existing.customer,\r\n    amount:    patch.amount    ?? existing.amount,\r\n    status:    patch.status    ?? existing.status,\r\n    date:      patch.date      ?? existing.date,\r\n  };\r\n\r\n  await table.updateEntity(updated, \"Replace\");\r\n\r\n  return {\r\n    id,\r\n    customer: updated.customer,\r\n    amount:   updated.amount,\r\n    status:   updated.status as OrderStatus,\r\n    date:     updated.date,\r\n  };\r\n}\r\n"]}